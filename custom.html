<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Customize</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f4;
        }
        .container {
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
            background-color: #fff;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
        }
        h1 {
            text-align: center;
            color: #333;
        }
        label {
            font-weight: bold;
            margin-top: 10px;
        }
        .editor {
            height: 200px;
            width: 100%;
            border: 1px solid #ccc;
            margin-bottom: 20px;
        }
        input#generatedURL {
            width: 100%;
            box-sizing: border-box;
            margin-bottom: 20px;
        }
        button {
            display: block;
            width: 100%;
            padding: 10px;
            background-color: #007BFF;
            color: #fff;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover {
            background-color: #0056b3;
        }
        .response-section {
            margin-top: 20px;
            padding: 20px;
            background-color: #e9ecef;
            border-radius: 8px;
        }
        .info {
            margin-top: 20px;
            font-size: 14px;
            color: #555;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Customizer</h1>
        <p>Customize the contents of this website with an URL</p>
        <label for="username">Username:</label><br>
        <input type="text" id="username" placeholder="hacker"><br><br>

        <label for="questions">Locking Questions (JSON):</label><br>
        <div id="questions" class="editor">[
{ "question": "Who is the target for the elimination contract?", "answer": "John Doe" }
]</div><br><br>

        <form id="urlBuilderForm">
            <label for="messages">Messages (JSON):</label><br>
            <div id="messages" class="editor">{
    "Anonymour buyer": [
        { "sender": "Agent Y", "text": "Le cadeau est accessible. Go. Now." },
        { "sender": "Me", "text": "omw" }
    ]
,
    "LowEloLegend": [
        { "sender": "LowEloLegend", "text": "Salut, je suis excité d'apprendre l'ordre de construction pour Age of Empires 2 !" },
        { "sender": "Me", "text": "Super ! Commençons par les bases. Tout d'abord, vous devez vous concentrer sur la collecte de nourriture. Envoyez vos villageois initiaux aux moutons." },
        { "sender": "LowEloLegend", "text": "Compris. Combien de villageois dois-je envoyer ?" },
        { "sender": "Me", "text": "Envoyez tous vos villageois initiaux aux moutons et créez de nouveaux villageois à partir de votre centre-ville." },
        { "sender": "LowEloLegend", "text": "D'accord, je m'en occupe. Quelle est la prochaine étape ?" },
        { "sender": "Me", "text": "Une fois que vous avez 6 villageois sur les moutons, envoyez les 4 villageois suivants au bois." },
        { "sender": "LowEloLegend", "text": "D'accord, 6 sur les moutons et 4 au bois. Quelle est la prochaine étape ?" },
        { "sender": "Me", "text": "Ensuite, envoyez 1 villageois construire une maison puis un moulin près des baies. Ensuite, envoyez ce villageois récolter des baies." },
        { "sender": "LowEloLegend", "text": "Compris. Combien de villageois doivent récolter des baies ?" },
        { "sender": "Me", "text": "Envoyez 4 villageois récolter des baies. Continuez à créer de nouveaux villageois et envoyez-les aux sources de nourriture." },
        { "sender": "LowEloLegend", "text": "D'accord. Que dois-je faire après avoir récolté des baies ?" },
        { "sender": "Me", "text": "Une fois que vous avez 4 villageois sur les baies, envoyez les 3 villageois suivants au bois." },
        { "sender": "LowEloLegend", "text": "D'accord, 3 de plus au bois. Quelle est la prochaine étape ?" },
        { "sender": "Me", "text": "Maintenant, envoyez 1 villageois construire une maison puis un camp minier près de l'or. Envoyez ce villageois extraire de l'or." },
        { "sender": "LowEloLegend", "text": "Combien de villageois doivent extraire de l'or ?" },
        { "sender": "Me", "text": "Envoyez 2 villageois extraire de l'or. Continuez à créer de nouveaux villageois et envoyez-les aux sources de nourriture." },
        { "sender": "LowEloLegend", "text": "Compris. Quelle est la prochaine étape ?" },
        { "sender": "Me", "text": "Une fois que vous avez suffisamment de nourriture, passez à l'âge féodal. Continuez à récolter des ressources et construisez une caserne." },
        { "sender": "LowEloLegend", "text": "D'accord, passer à l'âge féodal et construire une caserne. Quelle est la prochaine étape ?" },
        { "sender": "Me", "text": "À l'âge féodal, concentrez-vous sur la construction d'une écurie et d'un champ de tir à l'arc. Commencez à former des unités militaires." },
        { "sender": "LowEloLegend", "text": "Compris. Merci pour les conseils !" },
        { "sender": "Me", "text": "De rien ! Continuez à pratiquer et vous maîtriserez l'ordre de construction en un rien de temps." }
    ]
}</div><br><br>

            <label for="contracts">Contracts (JSON):</label><br>
            <div id="contracts" class="editor">[
    { "title": "Package aquisition", "description": "Location: Montreal. Target: Classified. Anonymous Buyer." },
    { "title": "Climbing the ladder", "description": "Location: Online. Instruction: Reach out to LowEloLegend in pm." }
]</div><br><br>

            <label for="notes">Notes (JSON):</label><br>
            <div id="notes" class="editor">[
                { "title": "Mercenary summit, meeting Notes", "description": "This could have been an email" },
                { "title": "Shopping List", "description": "Gnocci, gnocci, gnocci, gnocci" }
            ]</div><br><br>

            <button type="button" onclick="generateURLs()">Generate URL</button>
        </form>
        <div class="response-section">
            <label for="generatedURL">Generated URL:</label><br>
            <input type="text" id="generatedURL" readonly>
            <label for="prefilledURL">Prefilled URL:</label><br>
            <input type="text" id="prefilledURL" readonly>
        </div>
        <div class="info">
            <p>To get a shorter URL, you can use a service like <a href="https://tinyurl.com/" target="_blank">TinyURL</a>. Simply copy the generated URL and paste it into TinyURL to get a shortened version.</p>
            <p>To turn the URL into a QR code, you can use a service like <a href="https://www.qr-code-generator.com/" target="_blank">QR Code Generator</a>. Paste the shortened URL into the QR code generator to create a QR code that can be scanned with a mobile device.</p>
        </div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/ace.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.0.0/crypto-js.min.js"></script>
    <script>
        function initializeEditor(id) {
            const editor = ace.edit(id);
            editor.session.setMode("ace/mode/json");
            editor.setTheme("ace/theme/github");
            editor.setOptions({
                maxLines: Infinity,
                autoScrollEditorIntoView: true
            });
            return editor;
        }

        const messagesEditor = initializeEditor('messages');
        const contractsEditor = initializeEditor('contracts');
        const questionsEditor = initializeEditor('questions');
        const notesEditor = initializeEditor('notes');

        const encryptionKey = 'my-hardcoded-key-123-anne11kdvnepLAOOAaaaaaaddpakcgi'; // Hardcoded key for encryption/decryption

        // Function to encrypt data
        function encryptData(data) {
            const cipher = CryptoJS.AES.encrypt(data, encryptionKey);
            return cipher.toString();
        }

        function validateAndFormatJSON(jsonString) {
            try {
                const jsonObject = JSON.parse(jsonString);
                return JSON.stringify(jsonObject, null, 2);
            } catch (e) {
                alert("Invalid JSON format: " + e.message);
                throw new Error("Invalid JSON format");
            }
        }

        function generateURLs() {
            try {
                const messages = validateAndFormatJSON(messagesEditor.getValue());
                const contracts = validateAndFormatJSON(contractsEditor.getValue());
                const questions = validateAndFormatJSON(questionsEditor.getValue());
                const notes = validateAndFormatJSON(notesEditor.getValue());
                const username = document.getElementById('username').value || 'hacker';

                const encryptedMessages = encodeURIComponent(encryptData(messages));
                const encryptedContracts = encodeURIComponent(encryptData(contracts));
                const encryptedQuestions = encodeURIComponent(encryptData(questions));
                const encryptedNotes = encodeURIComponent(encryptData(notes));

                const currentUrl = window.location.href.split('?')[0]; // Strip any URL parameters
                const baseUrl = currentUrl.substring(0, currentUrl.lastIndexOf('/')) + '/index.html'; // Replace current page with index.html

                const generatedUrl = `${baseUrl}?messages=${encryptedMessages}&contracts=${encryptedContracts}&questions=${encryptedQuestions}&notes=${encryptedNotes}&username=${username}`;
                document.getElementById('generatedURL').value = generatedUrl;

                const prefilledUrl = `${currentUrl}?messages=${encryptedMessages}&contracts=${encryptedContracts}&questions=${encryptedQuestions}&notes=${encryptedNotes}&username=${username}`;
                document.getElementById('prefilledURL').value = prefilledUrl;
            } catch (e) {
                // Handle error if JSON validation fails
            }
        }

        function getURLParameter(name) {
            return decodeURIComponent((new RegExp('[?|&]' + name + '=' + '([^&;]+?)(&|#|;|$)').exec(location.search) || [null, ''])[1].replace(/\+/g, '%20')) || null;
        }

        function prefillForm() {
            const username = getURLParameter('username');
            const messages = getURLParameter('messages');
            const contracts = getURLParameter('contracts');
            const questions = getURLParameter('questions');
            const notes = getURLParameter('notes');

            if (username) {
                document.getElementById('username').value = username;
            }
            if (messages) {
                messagesEditor.setValue(CryptoJS.AES.decrypt(messages, encryptionKey).toString(CryptoJS.enc.Utf8));
            }
            if (contracts) {
                contractsEditor.setValue(CryptoJS.AES.decrypt(contracts, encryptionKey).toString(CryptoJS.enc.Utf8));
            }
            if (questions) {
                questionsEditor.setValue(CryptoJS.AES.decrypt(questions, encryptionKey).toString(CryptoJS.enc.Utf8));
            }
            if (notes) {
                notesEditor.setValue(CryptoJS.AES.decrypt(notes, encryptionKey).toString(CryptoJS.enc.Utf8));
            }
        }

        window.onload = prefillForm;

        document.getElementById('urlBuilderForm').addEventListener('submit', function(event) {
            event.preventDefault();
            generateURLs();
        });
    </script>
</body>
</html>